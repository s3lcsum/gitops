# yaml-language-server: $schema=https://raw.githubusercontent.com/recyclarr/recyclarr/master/schemas/config-schema.json
# ================================================================================================
# Configarr Configuration for Media Quality Management
# ================================================================================================
# This configuration manages quality profiles and custom formats for Radarr (movies) and Sonarr (TV shows)
# Configarr helps maintain consistent quality standards across your media servers

# ===========================================
# Repository Configuration
# ===========================================
# Configarr needs access to TRaSH-Guides and Recyclarr repositories for templates
trashGuideUrl: https://github.com/TRaSH-Guides/Guides
recyclarrConfigUrl: https://github.com/recyclarr/config-templates

# ===========================================
# Custom Format Definitions (Language Preferences)
# ===========================================
customFormatDefinitions:
  # Language: Original Audio (highest priority for HD/UHD profiles)
  - trash_id: language-original
    trash_scores:
      default: 100
    trash_description: "Prefer original language audio"
    name: "Language: Original"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: Original Language
        implementation: LanguageSpecification
        negate: false
        required: false
        fields:
          value: 0

  # Language: English (required for Anime, secondary for others)
  - trash_id: language-english
    trash_scores:
      default: 50
    trash_description: "English language - required for Anime, secondary for others"
    name: "Language: English"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: English Language
        implementation: LanguageSpecification
        negate: false
        required: false
        fields:
          value: 1

  # Language: Japanese (fallback for Anime only)
  - trash_id: language-japanese
    trash_scores:
      default: 25
    trash_description: "Japanese language - fallback for Anime when English unavailable"
    name: "Language: Japanese"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: Japanese Language
        implementation: LanguageSpecification
        negate: false
        required: false
        fields:
          value: 3

  # Language: Not English (penalty for Anime profile only)
  - trash_id: language-not-english
    trash_scores:
      default: -10000
    trash_description: "Block non-English for Anime (except Japanese)"
    name: "Language: Not English/Japanese"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: Not English or Japanese
        implementation: LanguageSpecification
        negate: true
        required: false
        fields:
          value: 1

  # Codec: Prefer H.265/HEVC (efficient compression for 720p+)
  - trash_id: codec-prefer-h265
    trash_scores:
      default: 15
    trash_description: "Prefer H.265/HEVC codec - efficient compression, smaller file sizes for HD+ content"
    name: "Codec: H.265/HEVC"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: H.265/HEVC Codec
        implementation: ReleaseTitleSpecification
        negate: false
        required: false
        fields:
          value: "\\b(HEVC|H\\.265)\\b"

  # Codec: Prefer x265 encoder (efficient encoding)
  - trash_id: codec-prefer-x265
    trash_scores:
      default: 10
    trash_description: "Prefer x265 encoder - modern, efficient encoding for HD+ content"
    name: "Codec: x265"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: x265 Encoder
        implementation: ReleaseTitleSpecification
        negate: false
        required: false
        fields:
          value: "\\bx265\\b"

  # Codec: Avoid H.264/AVC for HD+ content (inefficient)
  - trash_id: codec-avoid-h264-hd
    trash_scores:
      default: -15
    trash_description: "Avoid H.264/AVC for HD+ content - less efficient compression"
    name: "Codec: H.264/AVC (HD Penalty)"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: H.264/AVC Codec
        implementation: ReleaseTitleSpecification
        negate: false
        required: false
        fields:
          value: "\\b(H\\.264|AVC)\\b"

  # Codec: Avoid x264 encoder for HD+ content (inefficient)
  - trash_id: codec-avoid-x264-hd
    trash_scores:
      default: -10
    trash_description: "Avoid x264 encoder for HD+ content - older, less efficient"
    name: "Codec: x264 (HD Penalty)"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: x264 Encoder
        implementation: ReleaseTitleSpecification
        negate: false
        required: false
        fields:
          value: "\\bx264\\b"

  # Size: Block releases over 30GB (prevents massive downloads)
  - trash_id: size-block-over-30gb
    trash_scores:
      default: -10000
    trash_description: "Block any releases over 30GB to prevent massive downloads"
    name: "Size: Over 30GB (Blocked)"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: File Size Over 30GB
        implementation: SizeSpecification
        negate: false
        required: false
        fields:
          min: 0
          max: 32212254720

  # Quality: Block SD content (below 720p) - using resolution specification
  - trash_id: quality-block-sd
    trash_scores:
      default: -10000
    trash_description: "Block SD quality content (480p, 576p, DVD) - 720p minimum"
    name: "Quality: SD (Blocked)"
    includeCustomFormatWhenRenaming: false
    specifications:
      - name: SD Resolution
        implementation: ResolutionSpecification
        negate: false
        required: false
        fields:
          value: 2  # 480p/576p (SD)

# ================================
# Radarr Configuration (Movies)
# ================================
radarr:
  radarr:
    # Connection settings - pulled from secrets file
    base_url: !secret RADARR_URL        # Radarr server URL
    api_key: !secret RADARR_API_KEY     # Radarr API key for authentication

    # Include baseline quality profiles and custom formats:
    include:
      - template: radarr-custom-formats-anime         # Anime-specific custom formats
      - template: radarr-custom-formats-hd-bluray-web # HD Blu-ray and web release formats
      - template: radarr-custom-formats-uhd-bluray-web # 4K UHD custom formats
      - template: radarr-quality-profile-anime        # Creates "Remux-1080p - Anime" profile
      - template: radarr-quality-profile-hd-bluray-web # Creates "HD Bluray + Web" profile
      - template: radarr-quality-profile-uhd-bluray-web # Creates "UHD Bluray + Web" profile

    # Profile Configuration:
    # - "HD Bluray + Web" = HD/UHD combined (allows 4K upgrades)
    # - "Remux-1080p - Anime" = Anime profile (720p minimum)
    # - "UHD Bluray + Web" = 4K forced profile
    
    quality_profiles:
      - name: HD Bluray + Web
        upgrade:
          allowed: true
          until_quality: Bluray-2160p  # Allow upgrades to 4K Blu-ray
          until_score: 10000
        min_format_score: 0
        reset_unmatched_scores:
          enabled: true

    # ===========================================
    # Root Folders Configuration
    # ===========================================
    # Configure root folders for media storage
    root_folders:
      - /data/movies


    # ===========================================
    # Custom Format Assignments (Copied from Recyclarr)
    # ===========================================
    # Custom formats help score releases based on quality indicators
    # Higher scores = preferred releases, lower/negative scores = avoided releases
    custom_formats:
      # ===========================================
      # Preferred Movie Versions (Higher Quality Editions)
      # ===========================================
      # These formats get positive scores and are preferred for downloads
      - trash_ids:
          # Movie versions - Special/high-quality editions
          - 570bc9ebecd92723d2d21500f4be314c # Remaster (enhanced versions)
          - eca37840c13c6ef2dd0262b141a5482f # 4K Remaster (4K enhanced versions)
          - e0c07d59beb37348e975a930d5e50319 # Criterion Collection (prestigious releases)
          - 9d27d9d2181838f76dee150882bdc58c # Masters of Cinema (high-quality releases)
          - db9b4c4b53d312a3ca5f1378f6440fc9 # Vinegar Syndrome (cult/classic restorations)
          - eecf3a857724171f968a66cb5719e152 # IMAX (theatrical IMAX versions)
          - 9f6cbff8cfe4ebbc1bde14c7b7bec0de # IMAX Enhanced (enhanced IMAX versions)
          #- 957d0f44b592285f26449575e8b1167e # Special Editions (commented out)
          #- e9001909a4c88013a359d0b9920d7bea # Theatrical Cuts (commented out)

          # ===========================================
          # Exclusion Formats (Negative Scores - Avoid These)
          # ===========================================
          # These get negative scores to avoid poor quality releases
          - b6832f586342ef70d9c128d40c07b872 # Bad dual groups (poor dual audio)
          - cc444569854e9de0b084ab2b8b1532b2 # B&W editions (black and white versions)
          - ae9b7c9ebde1f3bd336a8cbd1ec4c5e5 # No RIsGroup (unreliable groups)
          - 7357cf5161efbf8c4d5d0c30b4815ee2 # Obfuscated (obfuscated filenames)
          # - 5c44f52a8714fdd79bb4fdd79bb4d98e2673be1f # Retags (invalid - commented out)
          - f537cf427b64c38c8e36298f657e4828 # Scene (scene releases, often lower quality)
        assign_scores_to:
          - name: HD Bluray + Web

      # ===========================================
      # Language Preferences for HD/UHD Profile
      # ===========================================
      # Priority: Original (100) > English (50)
      - trash_ids:
          - language-original
        assign_scores_to:
          - name: HD Bluray + Web
            score: 100
      - trash_ids:
          - language-english
        assign_scores_to:
          - name: HD Bluray + Web
            score: 50

      # ===========================================
      # Language Preferences for Anime Profile
      # ===========================================
      # Priority: English (REQUIRED - 100) > Japanese (fallback - 25)
      - trash_ids:
          - language-english
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: 100
      - trash_ids:
          - language-japanese
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: 25
      
      # Block SD quality (below 720p)
      - trash_ids:
          - quality-block-sd
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: -10000

      # ===========================================
      # Codec Preferences for HD/UHD Profile
      # ===========================================
      # Light codec preferences (quality not critical, just prefer efficiency)
      - trash_ids:
          - codec-prefer-h265
        assign_scores_to:
          - name: HD Bluray + Web
            score: 5  # Small bonus for H.265
      - trash_ids:
          - size-block-over-30gb
        assign_scores_to:
          - name: HD Bluray + Web
            score: -10000

      # ===========================================
      # Codec Preferences for Anime Profile
      # ===========================================
      # Light codec preferences (quality flexible)
      - trash_ids:
          - codec-prefer-h265
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: 5  # Small bonus for H.265
      - trash_ids:
          - size-block-over-30gb
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: -10000

      # ===========================================
      # Language Preferences for UHD Profile
      # ===========================================
      # Priority: Original (100) > English (50) - same as HD/UHD
      - trash_ids:
          - language-original
        assign_scores_to:
          - name: UHD Bluray + Web
            score: 100
      - trash_ids:
          - language-english
        assign_scores_to:
          - name: UHD Bluray + Web
            score: 50

      # ===========================================
      # 4K UHD Codec Preferences
      # ===========================================
      # Prefer efficient codecs for 4K content to keep file sizes manageable
      - trash_ids:
          - codec-prefer-h265
        assign_scores_to:
          - name: UHD Bluray + Web
            score: 20
      - trash_ids:
          - codec-prefer-x265
        assign_scores_to:
          - name: UHD Bluray + Web
            score: 15
      - trash_ids:
          - codec-avoid-h264-hd
        assign_scores_to:
          - name: UHD Bluray + Web
            score: -25
      - trash_ids:
          - codec-avoid-x264-hd
        assign_scores_to:
          - name: UHD Bluray + Web
            score: -20
      - trash_ids:
          - size-block-over-30gb
        assign_scores_to:
          - name: UHD Bluray + Web
            score: -10000

# ================================
# Sonarr Configuration (TV Shows)
# ================================
sonarr:
  sonarr:
    # Connection settings - pulled from secrets file
    base_url: !secret SONARR_URL        # Sonarr server URL
    api_key: !secret SONARR_API_KEY     # Sonarr API key for authentication

    # Include baseline quality profiles and custom formats:
    include:
      - template: sonarr-v4-custom-formats-anime         # Anime custom formats for Sonarr v4
      - template: sonarr-v4-custom-formats-web-1080p     # Web 1080p custom formats for Sonarr v4
      - template: sonarr-v4-custom-formats-web-2160p     # Web 4K UHD custom formats for Sonarr v4
      - template: sonarr-v4-quality-profile-anime        # Creates "Remux-1080p - Anime" profile
      - template: sonarr-v4-quality-profile-web-1080p    # Creates "WEB-1080p" profile
      - template: sonarr-v4-quality-profile-web-2160p    # Creates "WEB-UHD" profile

    # Profile Configuration:
    # Note: Sonarr's WEB-1080p and WEB-2160p are separate profiles by design
    # - "WEB-1080p" = HD profile (720p-1080p) - use this for most shows
    # - "Remux-1080p - Anime" = Anime profile (720p minimum)
    # - "WEB-2160p" = 4K profile - use this when you specifically want 4K
    #
    # Unlike Radarr, Sonarr keeps HD and 4K profiles separate. To get both:
    # - Manually edit WEB-1080p in Sonarr UI → Quality Settings → Enable WEB 2160p
    # OR
    # - Use WEB-2160p profile for shows you want in 4K
    

    # ===========================================
    # Root Folders Configuration
    # ===========================================
    # Configure root folders for media storage
    root_folders:
      - /data/tv


    # ===========================================
    # Custom Format Assignments (Copied from Recyclarr)
    # ===========================================
    # Custom formats help score TV releases based on quality indicators
    # Higher scores = preferred releases, lower/negative scores = avoided releases
    custom_formats:
      # ===========================================
      # Exclusion Formats for TV Shows (Negative Scores - Avoid These)
      # ===========================================
      # These get negative scores to avoid poor quality TV releases
      - trash_ids:
          - 32b367365729d530ca1c124a0b180c64 # Bad dual groups (poor dual audio)
          - 82d40da2bc6923f41e14394075dd4b03 # No-RIs group (unreliable groups)
          - e1a997ddb54e3ecbfe06341ad323c458 # Obfuscated (obfuscated filenames)
          - 06d66ab109d4d2eddb2794d21526d140 # Retags (re-tagged releases)
          - 1b3994c551cbb92a2c781af061f4ab44 # Scene (scene releases, often lower quality)
        assign_scores_to:
          - name: WEB-1080p  # Apply these scores to the WEB-1080p quality profile

      # ===========================================
      # Language Preferences for WEB-1080p Profile (HD/UHD)
      # ===========================================
      # Priority: Original (100) > English (50)
      - trash_ids:
          - language-original
        assign_scores_to:
          - name: WEB-1080p
            score: 100
      - trash_ids:
          - language-english
        assign_scores_to:
          - name: WEB-1080p
            score: 50

      # ===========================================
      # Language Preferences for Anime TV Shows
      # ===========================================
      # Priority: English (REQUIRED - 100) > Japanese (fallback - 25)
      - trash_ids:
          - language-english
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: 100
      - trash_ids:
          - language-japanese
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: 25
      
      # Block SD quality (below 720p)
      - trash_ids:
          - quality-block-sd
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: -10000

      # ===========================================
      # Codec Preferences for WEB-1080p (HD/UHD)
      # ===========================================
      # Light codec preferences (quality not critical)
      - trash_ids:
          - codec-prefer-h265
        assign_scores_to:
          - name: WEB-1080p
            score: 5  # Small bonus for H.265
      - trash_ids:
          - size-block-over-30gb
        assign_scores_to:
          - name: WEB-1080p
            score: -10000

      # ===========================================
      # Codec Preferences for Anime TV Shows
      # ===========================================
      # Light codec preferences (quality flexible)
      - trash_ids:
          - codec-prefer-h265
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: 5  # Small bonus for H.265
      - trash_ids:
          - size-block-over-30gb
        assign_scores_to:
          - name: Remux-1080p - Anime
            score: -10000

      # ===========================================
      # Language Preferences for WEB-UHD Profile (4K)
      # ===========================================
      # Priority: Original (100) > English (50) - same as WEB-1080p
      - trash_ids:
          - language-original
        assign_scores_to:
          - name: WEB-2160p  # Actual profile name in Sonarr
            score: 100
      - trash_ids:
          - language-english
        assign_scores_to:
          - name: WEB-2160p  # Actual profile name in Sonarr
            score: 50

      # ===========================================
      # 4K UHD Codec Preferences for TV Shows
      # ===========================================
      - trash_ids:
          - codec-prefer-h265
        assign_scores_to:
          - name: WEB-2160p  # Actual profile name in Sonarr
            score: 20
      - trash_ids:
          - codec-prefer-x265
        assign_scores_to:
          - name: WEB-2160p
            score: 15
      - trash_ids:
          - codec-avoid-h264-hd
        assign_scores_to:
          - name: WEB-2160p
            score: -25
      - trash_ids:
          - codec-avoid-x264-hd
        assign_scores_to:
          - name: WEB-2160p
            score: -20
      - trash_ids:
          - size-block-over-30gb
        assign_scores_to:
          - name: WEB-2160p
            score: -10000
